/**
 * Mutation hook template generator
 *
 * Generates createMutation-based hooks for canister update methods.
 */

import type { MethodInfo } from "../types.js"
import {
  toPascalCase,
  getHookExportName,
  getReactHookName,
  getReactorName,
} from "../naming.js"

export interface MutationHookOptions {
  canisterName: string
  method: MethodInfo
}

/**
 * Generate a mutation hook file content
 */
export function generateMutationHook(options: MutationHookOptions): string {
  const { canisterName, method } = options

  const pascalMethod = toPascalCase(method.name)
  const reactorName = getReactorName(canisterName)
  const hookExportName = getHookExportName(method.name, "mutation")
  const reactHookName = getReactHookName(method.name, "mutation")

  return `/**
 * Mutation Hook: ${method.name}
 *
 * Auto-generated by @ic-reactor/codegen
 * This hook wraps the ${method.name} update method.
 *
 * @example
 * // Use the hook in a component
 * const { mutate, isPending } = ${reactHookName}()
 *
 * // Call the mutation
 * mutate(${method.hasArgs ? "[arg1, arg2]" : "[]"})
 *
 * // Or execute directly
 * const result = await execute${pascalMethod}(${method.hasArgs ? "[arg1, arg2]" : "[]"})
 */

import { createMutation } from "@ic-reactor/react"
import { ${reactorName} } from "../reactor"

// ═══════════════════════════════════════════════════════════════════════════
// MUTATION INSTANCE
// ═══════════════════════════════════════════════════════════════════════════

/**
 * Mutation for ${method.name}
 *
 * Provides:
 * - .useMutation() - React hook
 * - .execute() - Direct execution
 */
export const ${hookExportName} = createMutation(${reactorName}, {
  functionName: "${method.name}",
  // ─────────────────────────────────────────────────────────────────────────
  // INVALIDATION
  // ─────────────────────────────────────────────────────────────────────────
  // Uncomment and import query keys to auto-invalidate on success:
  // invalidateQueries: [
  //   someQuery.getQueryKey(),
  // ],

  // ─────────────────────────────────────────────────────────────────────────
  // SUCCESS HANDLER
  // ─────────────────────────────────────────────────────────────────────────
  // onSuccess: (data, variables, context) => {
  //   console.log("${method.name} succeeded:", data)
  // },

  // ─────────────────────────────────────────────────────────────────────────
  // ERROR HANDLERS
  // ─────────────────────────────────────────────────────────────────────────
  // Handle canister-level errors (from Result { Err })
  // onCanisterError: (error, variables) => {
  //   console.error("Canister error:", error)
  // },

  // Handle all errors (network, canister, etc.)
  // onError: (error, variables, context) => {
  //   console.error("Error:", error)
  // },
})

// ═══════════════════════════════════════════════════════════════════════════
// CONVENIENCE EXPORTS
// ═══════════════════════════════════════════════════════════════════════════

/**
 * React hook for ${method.name}
 *
 * @param options - Mutation options (onSuccess, onError, etc.)
 */
export const ${reactHookName} = ${hookExportName}.useMutation

/**
 * Execute ${method.name} directly (outside of React)
 *
 * @param args - Arguments to pass to the canister method
 */
export const execute${pascalMethod} = ${hookExportName}.execute
`
}
